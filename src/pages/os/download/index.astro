---
import Layout from "../../../layouts/Layout.astro";
---

<Layout title="Download FluxLinux">
    <div class="bg-gray-50 dark:bg-dark py-16 sm:py-24">
        <div class="mx-auto max-w-7xl px-6 lg:px-8">
            <div class="mx-auto max-w-2xl text-center">
                <h1
                    class="text-3xl font-bold tracking-tight text-gray-900 dark:text-white sm:text-4xl"
                >
                    Download FluxLinux
                </h1>
                <p
                    class="mt-4 text-lg leading-8 text-gray-600 dark:text-gray-300"
                >
                    Get the latest version of FluxLinux. Lightweight, modern,
                    and under your control.
                </p>
                <div
                    class="mt-4 inline-flex items-center px-3 py-1 rounded-full bg-amber-100 text-amber-800 text-sm font-medium"
                >
                    Version: 1.4
                </div>
                <p class="mt-2 text-sm text-gray-500">
                    FluxLinux is built on Linux Mint. You might still encounter
                    some Linux Mint branding while we work on a complete
                    rebrand.
                </p>
            </div>

            <div
                class="mx-auto mt-16 max-w-2xl rounded-3xl ring-1 ring-gray-200 dark:ring-gray-700 bg-white dark:bg-slate-800 sm:mt-20 lg:mx-0 lg:flex lg:max-w-none"
            >
                <div class="p-8 sm:p-10 lg:flex-auto">
                    <h3
                        class="text-2xl font-bold tracking-tight text-gray-900 dark:text-white"
                    >
                        FluxLinux Desktop
                    </h3>
                    <p
                        class="mt-6 text-base leading-7 text-gray-600 dark:text-gray-300"
                    >
                        The standard edition with our curated desktop
                        experience.
                    </p>
                    <div class="mt-10 flex items-center gap-x-4">
                        <h4
                            class="flex-none text-sm font-semibold leading-6 text-primary"
                        >
                            Specs
                        </h4>
                        <div
                            class="h-px flex-auto bg-gray-100 dark:bg-gray-700"
                        >
                        </div>
                    </div>
                    <ul
                        role="list"
                        class="mt-8 grid grid-cols-1 gap-4 text-sm leading-6 text-gray-600 dark:text-gray-300 sm:grid-cols-2 sm:gap-6"
                    >
                        <li class="flex gap-x-3">
                            <svg
                                class="h-6 w-5 flex-none text-primary"
                                viewBox="0 0 20 20"
                                fill="currentColor"
                                aria-hidden="true"
                                ><path
                                    fill-rule="evenodd"
                                    d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z"
                                    clip-rule="evenodd"></path>
                            </svg>
                            Kernel: 6.8.x
                        </li>
                        <li class="flex gap-x-3">
                            <svg
                                class="h-6 w-5 flex-none text-primary"
                                viewBox="0 0 20 20"
                                fill="currentColor"
                                aria-hidden="true"
                                ><path
                                    fill-rule="evenodd"
                                    d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z"
                                    clip-rule="evenodd"></path>
                            </svg>
                            ISO Size: 3.0 GB
                        </li>
                        <li class="flex gap-x-3">
                            <svg
                                class="h-6 w-5 flex-none text-primary"
                                viewBox="0 0 20 20"
                                fill="currentColor"
                                aria-hidden="true"
                                ><path
                                    fill-rule="evenodd"
                                    d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z"
                                    clip-rule="evenodd"></path>
                            </svg>
                            64-bit AMD64
                        </li>
                    </ul>
                    <div class="mt-8 text-sm">
                        <p class="font-semibold text-gray-900 dark:text-white">
                            Verify Download:
                        </p>
                        <code
                            class="block mt-2 bg-gray-100 dark:bg-slate-900 p-2 rounded text-xs break-all"
                            >sha256sum FluxLinux-1.4-amd64.iso</code
                        >
                        <a
                            href="/os/download/fluxlinux-1.4-64bit.md5"
                            class="text-primary hover:underline mt-2 inline-block"
                            >Download Signature</a
                        >
                    </div>
                </div>
                <div
                    class="-mt-2 p-2 lg:mt-0 lg:w-full lg:max-w-md lg:flex-shrink-0"
                >
                    <div
                        class="rounded-2xl bg-gray-50 dark:bg-slate-900/50 py-10 text-center ring-1 ring-inset ring-gray-900/5 dark:ring-white/10 lg:flex lg:flex-col lg:justify-center lg:py-16"
                    >
                        <div class="mx-auto max-w-xs px-8">
                            <p
                                class="text-base font-semibold text-gray-600 dark:text-gray-400"
                            >
                                Direct Download
                            </p>
                            <p
                                class="mt-6 flex items-baseline justify-center gap-x-2"
                            >
                                <span
                                    class="text-5xl font-bold tracking-tight text-gray-900 dark:text-white"
                                    >Free</span
                                >
                                <span
                                    class="text-sm font-semibold leading-6 tracking-wide text-gray-600 dark:text-gray-400"
                                    >/ forever</span
                                >
                            </p>

                            <button
                                id="download-btn"
                                data-href="https://download.fluxlinux.xyz/fluxlinux-1.4-amd64.iso"
                                class="mt-10 block w-full rounded-md bg-primary px-8 py-4 text-center text-xl font-bold text-white shadow-lg hover:bg-primary-hover hover:shadow-xl focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary transition-all transform hover:-translate-y-1"
                                >Download ISO</button
                            >
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Newsletter Modal -->
    <dialog
        id="newsletter-modal"
        class="rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-slate-800 p-0 shadow-2xl backdrop:bg-black/50"
    >
        <div class="p-6 max-w-md">
            <div class="flex justify-between items-start mb-4">
                <h3 class="text-lg font-bold text-gray-900 dark:text-white">
                    Stay Updated
                </h3>
                <button
                    id="close-modal"
                    class="text-gray-400 hover:text-gray-500"
                >
                    <span class="sr-only">Close</span>
                    <svg
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        ><path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <p class="text-sm text-gray-600 dark:text-gray-300 mb-4">
                Get notified about new releases and major updates. No spam, we
                promise.
            </p>
            <div class="space-y-4">
                <input
                    type="email"
                    id="newsletter-email"
                    placeholder="Enter your email"
                    class="w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary dark:bg-slate-900 dark:border-gray-700 p-2 border"
                />
                <button
                    id="subscribe-btn"
                    class="w-full rounded-md bg-primary px-3 py-2 text-sm font-semibold text-white hover:bg-primary-hover"
                    >Subscribe & Download</button
                >
                <button
                    id="skip-btn"
                    class="w-full text-center text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 underline"
                    >No thanks, just download</button
                >
            </div>
        </div>
    </dialog>
</Layout>

<script>
    const downloadBtn = document.getElementById("download-btn");
    const modal = document.getElementById(
        "newsletter-modal"
    ) as HTMLDialogElement;
    const closeBtn = document.getElementById("close-modal");
    const skipBtn = document.getElementById("skip-btn");
    const subscribeBtn = document.getElementById("subscribe-btn");
    const emailInput = document.getElementById(
        "newsletter-email"
    ) as HTMLInputElement;

    let targetUrl = "";

    // Helper to get cookie consent status
    const hasConsent = () => {
        return localStorage.getItem("flux_cookie_consent") === "accepted";
    };

    // Track download event
    const trackDownload = async (version: string) => {
        if (!hasConsent()) return; // Respect privacy

        try {
            await fetch("/api/downloads", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    version,
                    userAgent: navigator.userAgent,
                    consent: true,
                }),
            });
        } catch (e) {
            console.error("Failed to track download:", e);
        }
    };

    if (downloadBtn && modal) {
        downloadBtn.addEventListener("click", (e) => {
            e.preventDefault();
            // @ts-ignore
            targetUrl = downloadBtn.dataset.href;
            modal.showModal();
        });

        const startDownload = () => {
            if (targetUrl) {
                // Track download
                trackDownload("1.4");
                window.location.href = targetUrl;
            }
            modal.close();
        };

        if (skipBtn) {
            skipBtn.addEventListener("click", startDownload);
        }

        if (closeBtn) {
            closeBtn.addEventListener("click", () => modal.close());
        }

        if (subscribeBtn && emailInput) {
            subscribeBtn.addEventListener("click", async () => {
                const email = emailInput.value;
                if (!email) {
                    alert("Please enter an email address");
                    return;
                }

                // Subscribe to newsletter
                try {
                    await fetch("/api/subscribe", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            email,
                            downloadedVersion: "1.4",
                        }),
                    });
                    alert("Subscribed!");
                } catch (e) {
                    console.log("Subscription failed:", e);
                }
                startDownload();
            });
        }
    }
</script>
